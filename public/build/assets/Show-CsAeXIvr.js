import{r as o,j as e}from"./ui-Ps9nvBG1.js";import{u as _e,K as De,t as g,h,m as te,L as We,C as v,a as N,b,c as w,d as C,e as S,I as A,q as Le,B as c,r as Te,f as x,T as y,i as k,j as _,g as P,k as D}from"./app-BTt_gkO3.js";import{S as Ue,a as Ee,b as Ie,c as Me,d as F}from"./select-z0EzYxFC.js";import{b as Ae,P as Pe,A as O,a as z,c as Fe,d as Oe}from"./page-template-BeQadk1c.js";import{A as re,a as ae}from"./alert-CnBrcYs9.js";import{E as ie}from"./EnhancedDeleteModal-BUN-gSW9.js";import{C as ze}from"./CrudDeleteModal-CAwcbZOF.js";import{E as $e}from"./eye-BGcEqodV.js";import{S as ne}from"./settings-CG31wyPI.js";import{U as le}from"./user-plus-cb7gLVi3.js";import{U as oe}from"./users-ClK0ij4u.js";import{M as ce}from"./mail-CZ8KgBhk.js";import{T as $}from"./trash-2-WsAE_ige.js";import{T as qe}from"./triangle-alert-BuDHDWvi.js";import{I as Be}from"./info-CWa1AAnn.js";import{S as de}from"./send-B0OsKa7V.js";import{C as me}from"./clock-NAV_RQL_.js";import{U as He}from"./user-DZ3jVi18.js";import{S as Ve}from"./shield-D21jpLkF.js";import{C as Je}from"./crown-h0ONqO0b.js";import"./vendor-B1hewrmX.js";/* empty css            *//* empty css                  */import"./utils-DVuJ_tgg.js";import"./index-C9qibMqK.js";import"./chevron-up-CaRG6751.js";import"./textarea-DPiv_-Qc.js";import"./react-country-flag.esm-2v5ikZ5v.js";import"./language-BbwPiY59.js";import"./loader-circle-LF6za7Wc.js";import"./trending-up-BkxnV74k.js";import"./language-switcher-AzCP_3T2.js";import"./switch-DG4amuEJ.js";import"./dropdown-menu-CvJwe1WI.js";import"./globe-BYIVGjA8.js";import"./building-2-CVOsE0mA.js";import"./square-check-big-B29hCoNu.js";import"./bug-DP5pb0Nw.js";import"./credit-card-BwPrmecT.js";import"./dollar-sign-CY6xo33T.js";import"./message-square-DGoN5Yg5.js";import"./use-favicon-vjALIuby.js";function Ms({workspace:r,availableRoles:i,errors:d,isSaasMode:W=!0}){var ee;const{t}=_e(),[q,L]=o.useState(!1),[B,T]=o.useState(!1),[p,U]=o.useState(null),[j,E]=o.useState(null),[he,I]=o.useState(!1),[xe,M]=o.useState(!1),[pe,je]=o.useState(0),{props:ue}=De(),{flash:l,auth:a}=ue,m=(a==null?void 0:a.permissions)||[],n=r.owner_id==((ee=a==null?void 0:a.user)==null?void 0:ee.id);o.useEffect(()=>{a!=null&&a.user&&!n&&fetch(route("workspaces.user-workspace-count")).then(s=>s.json()).then(s=>je(s.total_count)).catch(s=>console.error("Error fetching workspace count:",s))},[a==null?void 0:a.user,n]),o.useEffect(()=>{l!=null&&l.success&&g.success(l.success),l!=null&&l.error&&g.error(l.error),d!=null&&d.error&&(W&&d.upgrade_link?g.error(d.error,{action:{label:t("Upgrade Plan"),onClick:()=>window.open(d.upgrade_link,"_blank")},duration:6e3}):g.error(d.error))},[d,W,l]);const H=!n&&r.members.some(s=>{var se;return s.user.id===((se=a==null?void 0:a.user)==null?void 0:se.id)}),ge=H&&pe>1&&h(m,"workspace_leave"),fe=()=>{x.visit(route("users.all-logs"))},u=[];(n||H)&&h(m,"user_view_logs")&&u.push({label:t("User Logs History"),icon:e.jsx($e,{className:"h-4 w-4 mr-2"}),variant:"outline",onClick:()=>fe()}),n&&h(m,"workspace_update")&&u.push({label:t("Settings"),icon:e.jsx(ne,{className:"h-4 w-4 mr-2"}),variant:"outline",onClick:()=>T(!B)}),n&&h(m,"workspace_invite_members")&&u.push({label:t("Invite Member"),icon:e.jsx(le,{className:"h-4 w-4 mr-2"}),variant:"default",onClick:()=>L(!q),disabled:i.length===0}),ge&&u.push({label:t("Leave Workspace"),icon:e.jsx(Ae,{className:"h-4 w-4 mr-2"}),variant:"destructive",onClick:()=>M(!0)});const ve=[{title:t("Dashboard"),href:route("dashboard")},{title:t("Workspaces"),href:route("workspaces.index")},{title:r.name}],{data:V,setData:J,post:Ne,processing:K,errors:Y,reset:be}=te({email:"",role:i[0]||"member"}),{data:G,setData:Q,put:we,processing:X,errors:f}=te({name:r.name,description:r.description||"",task_delete_alert:r.task_delete_alert||!1}),Ce=s=>{s.preventDefault(),Ne(route("workspace.invitations.store",r.id),{preserveState:!1,onSuccess:()=>{be(),L(!1)}})},Se=s=>{s.preventDefault(),we(route("workspaces.update",r.id),{onSuccess:()=>{T(!1)}})},ye=()=>{x.delete(route("workspaces.destroy",r.id)),I(!1)},ke=()=>{x.post(route("workspaces.leave",r.id),{},{onSuccess:()=>{M(!1)},onError:s=>{console.error("Leave workspace error:",s),s.message&&g.error(s.message)}})},Z=s=>{switch(s){case"owner":return e.jsx(Je,{className:"w-4 h-4"});case"admin":return e.jsx(Ve,{className:"w-4 h-4"});default:return e.jsx(He,{className:"w-4 h-4"})}},R=s=>{switch(s){case"owner":return"bg-amber-100 text-amber-800 border-amber-200";case"admin":return"bg-red-100 text-red-800 border-red-200";case"member":return"bg-blue-100 text-blue-800 border-blue-200";case"client":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return e.jsxs(Pe,{title:r.name,subtitle:r.description,url:`/workspaces/${r.id}`,actions:u,breadcrumbs:ve,noPadding:!0,children:[e.jsx(We,{title:`${r.name} - ${t("Workspace")}`}),e.jsx("div",{className:"bg-white rounded-lg shadow mb-4",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{className:"w-10 h-10",children:e.jsx(z,{className:"bg-gradient-to-br from-blue-500 to-indigo-600 text-white font-bold text-sm",children:r.name.substring(0,2).toUpperCase()})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:r.name}),r.description&&e.jsx("p",{className:"text-gray-600 text-sm",children:r.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"}),r.members.length," ",t("members")]}),r.pending_invitations.length>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),r.pending_invitations.length," ",t("pending invitations")]})]})]})]})})}),B&&e.jsxs(v,{className:"mb-6",children:[e.jsxs(N,{children:[e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5"}),t("Workspace Settings")]}),e.jsx(w,{children:t("Update your workspace information and preferences.")})]}),e.jsx(C,{children:e.jsxs("form",{onSubmit:Se,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"name",children:t("Workspace Name")}),e.jsx(A,{id:"name",type:"text",value:G.name,onChange:s=>Q("name",s.target.value),required:!0}),f.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.name})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"description",children:t("Description")}),e.jsx(A,{id:"description",type:"text",value:G.description,onChange:s=>Q("description",s.target.value),placeholder:t("Workspace description (optional)")}),f.description&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.description})]})]}),e.jsx(Le,{}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{type:"submit",disabled:X,children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),t(X?"Saving...":"Save Changes")]}),e.jsx(c,{type:"button",variant:"outline",onClick:()=>T(!1),children:t("Cancel")})]}),n&&h(m,"workspace_delete")&&e.jsxs(c,{type:"button",variant:"destructive",onClick:()=>I(!0),children:[e.jsx($,{className:"w-4 h-4 mr-2"}),t("Delete Workspace")]})]})]})})]}),q&&e.jsxs(v,{className:"mb-6",children:[e.jsxs(N,{children:[e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5"}),t("Invite New Member")]}),e.jsx(w,{children:t("Send an invitation to add a new member to your workspace.")})]}),e.jsxs(C,{children:[i.length===0&&e.jsxs(re,{variant:"destructive",className:"mb-4",children:[e.jsx(qe,{className:"h-4 w-4"}),e.jsxs(ae,{children:[t("You have reached the member limit for your current plan."),e.jsx(c,{variant:"link",className:"p-0 h-auto ml-1 text-red-600 underline",onClick:()=>x.visit(route("plans.index")),children:t("Upgrade your plan")})," ",t("to invite more members.")]})]}),e.jsxs("form",{onSubmit:Ce,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"email",children:t("Email Address")}),e.jsx(A,{id:"email",type:"email",value:V.email,onChange:s=>J("email",s.target.value),placeholder:t("Enter email address"),required:!0,disabled:i.length===0}),Y.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:Y.email})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"role",children:t("Role")}),e.jsxs(Ue,{value:V.role,onValueChange:s=>J("role",s),disabled:i.length===0,children:[e.jsx(Ee,{children:e.jsx(Ie,{placeholder:i.length===0?t("No roles available"):t("Select role")})}),e.jsxs(Me,{children:[i.includes("manager")&&e.jsx(F,{value:"manager",children:t("Manager - Full access")}),i.includes("member")&&e.jsx(F,{value:"member",children:t("Member - Standard access")}),i.includes("client")&&e.jsx(F,{value:"client",children:t("Client - Limited access")})]})]}),i.length===0&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t("No roles available due to plan limits")})]})]}),i.length>0&&W&&e.jsxs(re,{children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsxs(ae,{children:[t("Available roles based on your current plan limits"),": ",i.join(", ")]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{type:"submit",disabled:K||i.length===0,children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),t(K?"Sending...":"Send Invitation")]}),e.jsx(c,{type:"button",variant:"outline",onClick:()=>L(!1),children:t("Cancel")})]})]})]})]}),e.jsx("div",{className:"mb-8",children:e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5"}),t("Members")," (",r.members.length,")"]}),e.jsx(w,{children:t("Manage workspace members and their roles.")})]}),e.jsx(C,{children:e.jsx("div",{className:"space-y-3",children:r.members.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(O,{className:"w-10 h-10",children:[s.user.avatar&&e.jsx(Fe,{src:s.user.avatar.startsWith("http")?s.user.avatar:`/storage/${s.user.avatar}`}),e.jsx(z,{className:"bg-gradient-to-br from-blue-500 to-indigo-600 text-white font-semibold",children:s.user.name.charAt(0).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.user.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.user.email}),e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-xs text-gray-400",children:[e.jsx(me,{className:"w-3 h-3"}),t("Joined")," ",new Date(s.joined_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{children:e.jsxs(k,{children:[e.jsx(_,{asChild:!0,children:e.jsxs(P,{className:R(s.role),children:[Z(s.role),e.jsx("span",{className:"ml-1 capitalize",children:s.role})]})}),e.jsx(D,{children:e.jsxs("p",{children:[t("Role"),": ",s.role]})})]})}),e.jsx(P,{variant:s.status==="active"?"default":"secondary",children:s.status}),s.role!=="owner"&&n&&h(m,"workspace_manage_members")&&e.jsx(y,{children:e.jsxs(k,{children:[e.jsx(_,{asChild:!0,children:e.jsx(c,{size:"sm",variant:"ghost",className:"text-red-500 hover:text-red-700 hover:bg-red-50",onClick:()=>E(s),children:e.jsx($,{className:"w-4 h-4"})})}),e.jsx(D,{children:e.jsx("p",{children:t("Remove member")})})]})})]})]},s.id))})})]})}),r.pending_invitations.length>0&&e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5"}),t("Pending Invitations")," (",r.pending_invitations.length,")"]}),e.jsx(w,{children:t("Manage pending workspace invitations.")})]}),e.jsx(C,{children:e.jsx("div",{className:"space-y-3",children:r.pending_invitations.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{className:"w-10 h-10",children:e.jsx(z,{className:"bg-gradient-to-br from-gray-400 to-gray-600 text-white font-semibold",children:s.email.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.email}),e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-xs text-gray-400",children:[e.jsx(me,{className:"w-3 h-3"}),t("Expires"),": ",new Date(s.expires_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(P,{className:R(s.role),children:[Z(s.role),e.jsx("span",{className:"ml-1 capitalize",children:s.role})]}),n&&h(m,"workspace_invite_members")&&e.jsx(y,{children:e.jsxs(k,{children:[e.jsx(_,{asChild:!0,children:e.jsx(c,{size:"sm",variant:"ghost",className:"text-blue-500 hover:text-blue-700 hover:bg-blue-50",onClick:()=>x.post(route("invitations.resend",s.id)),children:e.jsx(de,{className:"w-4 h-4"})})}),e.jsx(D,{children:e.jsx("p",{children:t("Resend invitation")})})]})}),n&&h(m,"workspace_manage_members")&&e.jsx(y,{children:e.jsxs(k,{children:[e.jsx(_,{asChild:!0,children:e.jsx(c,{size:"sm",variant:"ghost",className:"text-red-500 hover:text-red-700 hover:bg-red-50",onClick:()=>U(s),children:e.jsx($,{className:"w-4 h-4"})})}),e.jsx(D,{children:e.jsx("p",{children:t("Delete invitation")})})]})})]})]},s.id))})})]}),e.jsx(ie,{isOpen:!!p,onClose:()=>U(null),onConfirm:()=>{p&&(x.delete(route("invitations.destroy",p.id)),U(null))},itemName:(p==null?void 0:p.email)||"",entityName:t("Invitation"),warningMessage:t("This invitation will be permanently removed and cannot be recovered.")}),e.jsx(ie,{isOpen:!!j,onClose:()=>E(null),onConfirm:()=>{j&&(x.delete(route("workspace.remove-member",[r.id,j.user.id])),E(null))},itemName:(j==null?void 0:j.user.name)||"",entityName:t("Member"),warningMessage:t("This member will be removed from the workspace and lose access to all projects and data.")}),e.jsx(ze,{isOpen:he,onClose:()=>I(!1),onConfirm:ye,itemName:r.name,entityName:t("workspace")}),e.jsx(Oe,{isOpen:xe,onClose:()=>M(!1),onConfirm:ke,workspaceName:r.name})]})}export{Ms as default};
