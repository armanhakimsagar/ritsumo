import{r as y,j as e}from"./ui-Ps9nvBG1.js";import{J as O,u as F,K as E,s as U,C as I,B as x,X as A,v as _,t as C,D as z,l as q,n as P,o as H,e as D,I as L,ad as J,P as X}from"./app-BTt_gkO3.js";import{S as B}from"./switch-DG4amuEJ.js";import{R}from"./react-country-flag.esm-2v5ikZ5v.js";import{D as G,a as K,b as $,f as V,c as T,d as W}from"./dropdown-menu-CvJwe1WI.js";import{G as Q}from"./globe-BYIVGjA8.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Z=O("RefreshCw",Y);function ce(){const{t:n}=F(),{props:c}=E(),[g,a]=y.useState(!1),[m,f]=y.useState(!1),[r,l]=y.useState(!1),{themeColor:j,customColor:d}=U(),p=j==="custom"?d:_[j],i=c.globalSettings||{},u={cookieTitle:i.cookieTitle||"Cookie Consent",cookieDescription:i.cookieDescription||"We use cookies to enhance your browsing experience and provide personalized content.",strictlyCookieTitle:i.strictlyCookieTitle||"Strictly Necessary Cookies",strictlyCookieDescription:i.strictlyCookieDescription||"These cookies are essential for the website to function properly.",contactUsDescription:i.contactUsDescription||"If you have any questions about our cookie policy, please contact us.",contactUsUrl:i.contactUsUrl||"#"};y.useEffect(()=>{const t=i.enableLogging==="1"||i.enableLogging===1||i.enableLogging===!0,s=c.is_demo,h=window.location.pathname.includes("/dashboard"),o=window.location.pathname==="/"||window.location.pathname.includes("/landing");if(s){const b=sessionStorage.getItem("cookie-banner-dismissed");a(h&&!b);return}t&&(localStorage.getItem("cookie-consent")||a(!o))},[i,c]);const N=async()=>{try{const t=new AbortController,s=setTimeout(()=>t.abort(),5e3),h=await fetch("https://ipapi.co/json/",{signal:t.signal,headers:{Accept:"application/json"}});if(clearTimeout(s),!h.ok)throw new Error(`HTTP error! status: ${h.status}`);const o=await h.json();return{ip:o.ip||"unknown",country:o.country_name||"unknown",city:o.city||"unknown",region:o.region||"unknown",...o}}catch(t){return console.warn("Failed to get location data:",t.message),{ip:"unknown",country:"unknown",city:"unknown",region:"unknown",error:t.message||"Location fetch failed"}}},k=async(t,s)=>{var h;try{const o=await N(),b={...s,timestamp:new Date().toISOString(),consentType:t,userAgent:navigator.userAgent||"unknown",language:navigator.language||"unknown",url:window.location.href,...o};localStorage.setItem("cookie-consent",JSON.stringify({accepted:!0,timestamp:Date.now()}));const M=(h=document.querySelector('meta[name="csrf-token"]'))==null?void 0:h.getAttribute("content");if(!M){console.warn("CSRF token not found");return}const S=await fetch(route("cookie.consent.store"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":M,Accept:"application/json"},body:JSON.stringify(b)});if(!S.ok)throw new Error(`HTTP error! status: ${S.status}`);if(!(await S.json()).success)throw new Error("Server returned error")}catch(o){throw console.error("Failed to save cookie consent:",o),localStorage.setItem("cookie-consent",JSON.stringify({accepted:!0,timestamp:Date.now()})),o}},v=async()=>{if(!r){l(!0);try{const t={necessary:!0,analytics:!0,marketing:!0};c.is_demo?sessionStorage.setItem("cookie-banner-dismissed","true"):await k("accept_all",t),a(!1)}catch{C.error(n("Failed to save cookie preferences"))}finally{l(!1)}}},w=async()=>{if(!r){l(!0);try{const t={necessary:!0,analytics:!1,marketing:!1};c.is_demo?sessionStorage.setItem("cookie-banner-dismissed","true"):await k("necessary_only",t),a(!1)}catch{C.error(n("Failed to save cookie preferences"))}finally{l(!1)}}};return g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bottom-4 left-4 right-4 z-50 md:left-auto md:max-w-md",children:e.jsxs(I,{className:"p-4 shadow-lg border",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h3",{className:"font-semibold text-sm",children:u.cookieTitle}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>{c.is_demo&&sessionStorage.setItem("cookie-banner-dismissed","true"),a(!1)},className:"h-6 w-6 p-0",children:e.jsx(A,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:u.cookieDescription}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{onClick:v,size:"sm",className:"flex-1 text-white hover:opacity-90",style:{backgroundColor:p},disabled:r,children:n(r?"Saving...":"Accept All")}),e.jsx(x,{onClick:w,variant:"outline",size:"sm",className:"flex-1",style:{borderColor:p,color:p},disabled:r,children:n(r?"Saving...":"Necessary Only")})]}),e.jsx(x,{onClick:()=>f(!0),variant:"ghost",size:"sm",className:"text-sm underline",children:n("Let me choose")})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[u.contactUsDescription," ",e.jsx("a",{href:u.contactUsUrl,className:"underline",children:n("Contact us")})]})]})}),m&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",children:e.jsx(I,{className:"w-full max-w-md max-h-[80vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:u.cookieTitle}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>f(!1),className:"h-6 w-6 p-0",children:e.jsx(A,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm",children:u.strictlyCookieTitle}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:u.strictlyCookieDescription})]}),e.jsx(B,{checked:!0,disabled:!0})]})}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx(x,{onClick:async()=>{await w(),f(!1)},variant:"outline",size:"sm",className:"flex-1",style:{borderColor:p,color:p},disabled:r,children:n(r?"Saving...":"Save Preferences")}),e.jsx(x,{onClick:async()=>{await v(),f(!1)},size:"sm",className:"flex-1 text-white hover:opacity-90",style:{backgroundColor:p},disabled:r,children:n(r?"Saving...":"Accept All")})]})]})})})]}):null}function ee({open:n,onOpenChange:c,onSuccess:g}){const{t:a}=F(),[m,f]=y.useState({code:"",name:"",countryCode:""}),[r,l]=y.useState(!1),j=async d=>{var p;d.preventDefault(),l(!0);try{const i=await fetch(route("languages.create"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((p=document.querySelector('meta[name="csrf-token"]'))==null?void 0:p.getAttribute("content"))||"",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(m)}),u=await i.json();i.ok&&u.success?(C.success(u.message||a("Language created successfully")),f({code:"",name:"",countryCode:""}),c(!1),g==null||g(),window.location.reload()):C.error(u.error||a("Failed to create language"))}catch{C.error(a("Failed to create language"))}finally{l(!1)}};return e.jsx(z,{open:n,onOpenChange:c,children:e.jsxs(q,{className:"sm:max-w-md",children:[e.jsx(P,{children:e.jsx(H,{children:a("Create New Language")})}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(D,{htmlFor:"code",children:a("Language Code")}),e.jsx(L,{id:"code",placeholder:"e.g., fr, de, es",value:m.code,onChange:d=>f({...m,code:d.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"name",children:a("Language Name")}),e.jsx(L,{id:"name",placeholder:"e.g., French, German, Spanish",value:m.name,onChange:d=>f({...m,name:d.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"countryCode",children:a("Country Code")}),e.jsx(L,{id:"countryCode",placeholder:"e.g., FR, DE, ES",maxLength:2,value:m.countryCode,onChange:d=>f({...m,countryCode:d.target.value.toUpperCase()}),required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>c(!1),children:a("Cancel")}),e.jsx(x,{type:"submit",disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-4 w-4 animate-spin mr-2"}),a("Creating...")]}):a("Create")})]})]})]})})}const le=()=>{var w,t;const{t:n,i18n:c}=F(),{auth:g,is_saas:a,globalSettings:m}=E().props,[f,r]=y.useState(!1),[l,j]=y.useState(null),d=(m==null?void 0:m.availableLanguages)||[];y.useEffect(()=>{const s=(d||[]).filter(o=>o.enabled!==!1),h=s.find(o=>o.code===c.language)||s[0];j(h)},[c.language,d]);const p=g==null?void 0:g.user,i=((t=(w=g==null?void 0:g.user)==null?void 0:w.roles)==null?void 0:t.map(s=>s.name))||[],u=p&&J("superadmin",i),N=i.includes("company"),k=u||!a&&N,v=s=>{const h=d.find(o=>o.code===s);h&&(j(h),c.changeLanguage(s))};return e.jsxs(G,{children:[e.jsx(K,{asChild:!0,children:e.jsxs(x,{variant:"ghost",className:"flex items-center gap-2 h-8 rounded-md",children:[e.jsx(Q,{className:"h-4 w-4"}),l&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm font-medium hidden md:inline-block",children:l.name}),e.jsx(R,{countryCode:l.countryCode,svg:!0,style:{width:"1.2em",height:"1.2em"}})]})]})}),e.jsxs($,{className:"w-56",align:"end",forceMount:!0,children:[e.jsx(V,{children:e.jsx("div",{className:"max-h-48 overflow-y-auto",children:(d||[]).filter(s=>s.enabled!==!1).map(s=>e.jsxs(T,{onClick:()=>v(s.code),className:`flex items-center gap-2 ${(l==null?void 0:l.code)===s.code?"bg-accent":""}`,children:[e.jsx(R,{countryCode:s.countryCode,svg:!0,style:{width:"1.2em",height:"1.2em"}}),e.jsx("span",{children:s.name})]},s.code))})}),k&&e.jsxs(e.Fragment,{children:[e.jsx(W,{}),e.jsxs(T,{onClick:()=>r(!0),className:"justify-center text-primary font-semibold cursor-pointer",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),n("Create Language")]}),e.jsx(T,{asChild:!0,className:"justify-center text-primary font-semibold cursor-pointer",children:e.jsx("a",{href:route("manage-language"),rel:"noopener noreferrer",children:n("Manage Language")})})]})]}),e.jsx(ee,{open:f,onOpenChange:r,onSuccess:()=>r(!1)})]})};export{ce as C,le as L,Z as R,ee as a};
