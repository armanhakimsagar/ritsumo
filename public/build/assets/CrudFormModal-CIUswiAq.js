import{r as N,j as a}from"./ui-Ps9nvBG1.js";import{g as W,X as _,u as H,D as Q,l as X,n as J,o as K,p as Y,e as $,H as Z,B as L,I as z}from"./app-BTt_gkO3.js";import{T as f}from"./textarea-DPiv_-Qc.js";import{S as ee,a as ae,b as se,c as te,d as M}from"./select-z0EzYxFC.js";import{R as ne,a as re}from"./radio-group-JdhkNCQh.js";import{C as ce}from"./checkbox-ux8-2I9a.js";import{S as me}from"./switch-DG4amuEJ.js";import{S as le}from"./scroll-area-B8km6OEG.js";function oe({options:i,selected:p,onChange:S,placeholder:l="Select options",className:u}){const[k,m]=N.useState(!1),[q,d]=N.useState(""),t=N.useRef(null);N.useEffect(()=>{function o(y){t.current&&!t.current.contains(y.target)&&m(!1)}return document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}},[]);const T=o=>{p.includes(o)||S([...p,o]),d(""),setTimeout(()=>{var b;const y=(b=t.current)==null?void 0:b.querySelector("input");y&&y.focus()},10)},x=o=>{S(p.filter(y=>y!==o))},F=i.filter(o=>(q||!p.includes(o.value))&&o.label.toLowerCase().includes(q.toLowerCase()));return a.jsxs("div",{ref:t,className:`relative ${u}`,children:[a.jsxs("div",{className:"flex flex-wrap gap-1 p-2 border rounded-md min-h-[38px] cursor-text",onClick:()=>m(!0),children:[p.map(o=>{const y=i.find(b=>b.value===o);return a.jsxs(W,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[(y==null?void 0:y.label)||o,a.jsx("button",{type:"button",className:"ml-1 rounded-sm",onClick:b=>{b.stopPropagation(),x(o)},children:a.jsx(_,{className:"h-3 w-3 text-muted-foreground hover:text-foreground"})})]},o)}),a.jsx("input",{type:"text",value:q,onChange:o=>d(o.target.value),onFocus:()=>m(!0),placeholder:p.length===0?l:"",className:"flex-1 outline-none bg-transparent min-w-[50px]"})]}),k&&F.length>0&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border rounded-md shadow-lg max-h-[200px] overflow-y-auto",children:F.map(o=>a.jsx("div",{className:"px-3 py-2 cursor-pointer hover:bg-gray-100",onClick:()=>{T(o.value),m(!0)},children:o.label},o.value))})]})}function ie({field:i,formData:p,handleChange:S}){const l=Array.isArray(p[i.name])?p[i.name]:p[i.name]?[p[i.name].toString()]:[];return a.jsx(oe,{options:i.options||[],selected:l,onChange:u=>S(i.name,u),placeholder:i.placeholder||`Select ${i.label}`})}function be({isOpen:i,onClose:p,onSubmit:S,formConfig:l,initialData:u={},title:k,mode:m,description:q}){const{t:d}=H(),[t,T]=N.useState({}),[x,F]=N.useState({}),[o,y]=N.useState({}),b=()=>{if(!l.priceSummary)return 0;const e=t[l.priceSummary.quantityFieldName||"quantity"]||l.priceSummary.quantity||1;return l.priceSummary.unitPrice*e};N.useEffect(()=>{if(i){const e={...u};l.fields.forEach(r=>{r.type==="multi-select"&&e[r.name]&&!Array.isArray(e[r.name])&&(e[r.name]=Array.isArray(e[r.name])?e[r.name]:e[r.name]?[e[r.name].toString()]:[]),m==="create"&&(e[r.name]===void 0||e[r.name]===null)&&r.defaultValue!==void 0&&(e[r.name]=r.defaultValue)}),T(e||{}),F({}),l.fields.forEach(r=>{r.relation&&r.relation.endpoint&&fetch(r.relation.endpoint).then(c=>c.json()).then(c=>{y(h=>({...h,[r.name]:Array.isArray(c)?c:c.data||[]}))}).catch(c=>{})})}},[i,u,l.fields,m]);const j=(e,r)=>{T(c=>({...c,[e]:r})),x[e]&&F(c=>{const h={...c};return delete h[e],h})},R=e=>{e.preventDefault();const r={...t};l.fields.forEach(n=>{n.type==="multi-select"&&r[n.name]&&(Array.isArray(r[n.name])||(r[n.name]=[r[n.name].toString()]))}),T(r);const c={};if(l.fields.forEach(n=>{if(n.type==="file"&&m==="edit")return;const C=n.conditional?n.conditional(m,t):!0;if(n.required&&C&&!t[n.name]&&(c[n.name]=`${n.label} is required`),n.type==="file"&&t[n.name]&&n.fileValidation){const g=t[n.name];if(n.fileValidation.maxSize&&g.size>n.fileValidation.maxSize){const v=n.fileValidation.maxSize/1048576;c[n.name]=`File size must be less than ${v}MB`}if(n.fileValidation.mimeTypes&&n.fileValidation.mimeTypes.length>0&&(n.fileValidation.mimeTypes.includes(g.type)||(c[n.name]=`File type must be one of: ${n.fileValidation.mimeTypes.join(", ")}`)),n.fileValidation.extensions&&n.fileValidation.extensions.length>0){const v=g.name,w=v.substring(v.lastIndexOf(".")).toLowerCase();n.fileValidation.extensions.includes(w)||(c[n.name]=`File extension must be one of: ${n.fileValidation.extensions.join(", ")}`)}}}),Object.keys(c).length>0){F(c);return}const h={...t};l.fields.forEach(n=>{n.type==="multi-select"&&h[n.name]&&(Array.isArray(h[n.name])||(h[n.name]=[h[n.name].toString()]))}),S(h)},I=e=>{var r,c,h,n,C;if(e.conditional&&!e.conditional(m,t))return null;if(e.render)return e.render(e,t,j);if(e.type==="custom"&&e.component)return e.component;if(m==="view"){if(e.type==="multi-select"){const v=(Array.isArray(t[e.name])?t[e.name]:[]).map(w=>{var A;const V=(A=e.options)==null?void 0:A.find(E=>E.value===w);return V?V.label:w}).join(", ");return a.jsx("div",{className:"p-2 border rounded-md bg-gray-50",children:v||"-"})}return a.jsx("div",{className:"p-2 border rounded-md bg-gray-50",children:e.type==="select"&&e.options?((r=e.options.find(g=>g.value===String(t[e.name])))==null?void 0:r.label)||t[e.name]||"-":t[e.name]||"-"})}switch(e.type){case"text":case"email":case"password":case"time":return a.jsx(z,{id:e.name,name:e.name,type:e.type,placeholder:e.placeholder,value:t[e.name]||"",onChange:s=>j(e.name,s.target.value),required:e.required,className:x[e.name]?"border-red-500":"",disabled:m==="view"});case"date":const g=t[e.name]?t[e.name]instanceof Date?t[e.name].toISOString().split("T")[0]:typeof t[e.name]=="string"&&t[e.name].includes("T")?t[e.name].split("T")[0]:t[e.name]:"";return a.jsx(z,{id:e.name,name:e.name,type:"date",placeholder:e.placeholder,value:g,onChange:s=>j(e.name,s.target.value),required:e.required,className:x[e.name]?"border-red-500":"",disabled:m==="view"});case"number":return a.jsx(z,{id:e.name,name:e.name,type:"number",placeholder:e.placeholder,value:t[e.name]||"",onChange:s=>j(e.name,s.target.value?parseFloat(s.target.value):""),required:e.required,className:x[e.name]?"border-red-500":"",disabled:m==="view"});case"textarea":return a.jsx(f,{id:e.name,name:e.name,placeholder:e.placeholder,value:t[e.name]||"",onChange:s=>j(e.name,s.target.value),required:e.required,className:x[e.name]?"border-red-500":"",disabled:m==="view"});case"select":const v=e.relation?o[e.name]||[]:e.options||[],w=String(t[e.name]||""),V=e.relation?v.find(s=>String(s[e.relation.valueField])===w):v.find(s=>String(s.value)===w),A=V?e.relation?V[e.relation.labelField]:V.label:"";return a.jsxs(ee,{value:w,onValueChange:s=>j(e.name,s),disabled:m==="view",children:[a.jsx(ae,{className:x[e.name]?"border-red-500":"",children:a.jsx(se,{placeholder:e.placeholder||`Select ${e.label}`,children:A||e.placeholder||`Select ${e.label}`})}),a.jsx(te,{className:"z-[60000]",children:e.relation?v.map(s=>a.jsx(M,{value:String(s[e.relation.valueField]),children:s[e.relation.labelField]},s[e.relation.valueField])):v.map(s=>a.jsx(M,{value:String(s.value),children:s.label},s.value))})]});case"radio":return a.jsx(ne,{value:t[e.name]||"",onValueChange:s=>j(e.name,s),disabled:m==="view",className:"flex gap-4",children:(c=e.options)==null?void 0:c.map(s=>a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(re,{value:s.value,id:`${e.name}-${s.value}`}),a.jsx($,{htmlFor:`${e.name}-${s.value}`,children:s.label})]},s.value))});case"checkbox":return a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(ce,{id:e.name,checked:!!t[e.name],onCheckedChange:s=>j(e.name,s),disabled:m==="view"}),a.jsx($,{htmlFor:e.name,children:e.placeholder||e.label})]});case"switch":return a.jsx(me,{id:e.name,checked:!!t[e.name],onCheckedChange:s=>j(e.name,s),disabled:m==="view"});case"multi-select":return a.jsx(ie,{field:e,formData:t,handleChange:j});case"file":const E=((h=e.fileValidation)==null?void 0:h.accept)||"",U=E.includes("image")||(((C=(n=e.fileValidation)==null?void 0:n.mimeTypes)==null?void 0:C.some(s=>s.startsWith("image/")))??!1);return a.jsxs(a.Fragment,{children:[a.jsx(z,{id:e.name,name:e.name,type:"file",accept:E,onChange:s=>{s.target.files&&s.target.files[0]&&j(e.name,s.target.files[0])},className:x[e.name]?"border-red-500":"",disabled:m==="view"}),m==="edit"&&u[e.name]&&a.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Current file: ",u.featured_image_original_name||u[e.name]]}),e.fileValidation&&a.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[e.fileValidation.extensions&&a.jsxs("span",{children:[d("Allowed extensions"),": ",e.fileValidation.extensions.join(", ")," "]}),e.fileValidation.maxSize&&a.jsxs("span",{children:[d("Max size"),": ",(e.fileValidation.maxSize/(1024*1024)).toFixed(1),"MB"]})]}),U&&a.jsx("div",{className:"mt-2",children:t[e.name]&&t[e.name]instanceof File?a.jsxs("div",{className:"mt-2",children:[a.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:[d("Preview"),":"]}),a.jsx("img",{src:URL.createObjectURL(t[e.name]),alt:"Preview",className:"h-24 w-auto rounded-md object-cover shadow-sm"})]}):m==="edit"&&u[e.name]&&a.jsxs("div",{className:"mt-2",children:[a.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:[d("Current image"),":"]}),a.jsx("img",{src:typeof u[e.name]=="string"&&u[e.name].startsWith&&u[e.name].startsWith("http")?u[e.name]:`/storage/${u[e.name]}`,alt:"Current",className:"h-24 w-auto rounded-md object-cover shadow-sm",onError:s=>{s.currentTarget.src="https://placehold.co/200x150?text=Image+Not+Found"}})]})})]});default:return null}},P=()=>{const e={sm:"sm:max-w-sm",md:"sm:max-w-md",lg:"sm:max-w-lg",xl:"sm:max-w-xl","2xl":"sm:max-w-2xl","3xl":"sm:max-w-3xl","4xl":"sm:max-w-4xl","5xl":"sm:max-w-5xl",full:"sm:max-w-full"};return l.modalSize?e[l.modalSize]:"sm:max-w-md"},B=()=>{const e={};return l.fields.forEach(r=>{const c=r.row||0;e[c]||(e[c]=[]),e[c].push(r)}),Object.entries(e).sort(([r],[c])=>parseInt(r)-parseInt(c))},O=l.layout||"default",D=l.columns||1,G=`crud-modal-${m}-${Date.now()}`;return a.jsx(Q,{open:i,onOpenChange:p,children:a.jsxs(X,{className:`${P()} max-h-[90vh]`,modalId:G,children:[a.jsxs(J,{children:[a.jsx(K,{children:k}),a.jsx(Y,{children:q||" "})]}),a.jsx(le,{className:"max-h-[70vh] pr-4",children:a.jsxs("form",{onSubmit:R,className:"space-y-4",children:[l.priceSummary&&a.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-4",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsxs("span",{className:"text-sm text-gray-600",children:[d("Unit Price"),":"]}),a.jsxs("span",{className:"font-medium",children:["$",(()=>{var r;const e=l.priceSummary.unitPrice;return typeof window<"u"&&((r=window.appSettings)!=null&&r.formatCurrency)?window.appSettings.formatCurrency(e,{showSymbol:!0}):e.toFixed(2)})()]})]}),a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsxs("span",{className:"text-sm text-gray-600",children:[d("Quantity"),":"]}),a.jsx("span",{className:"font-medium",children:t[l.priceSummary.quantityFieldName||"quantity"]||l.priceSummary.quantity||1})]}),a.jsx("div",{className:"border-t pt-2",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("span",{className:"font-semibold",children:[d("Total Price"),":"]}),a.jsxs("span",{className:"font-bold text-lg text-primary",children:["$",b().toFixed(2)]})]})})]}),O==="grid"?a.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(${D}, 1fr)`,gap:"1rem"},children:l.fields.map(e=>e.conditional&&!e.conditional(m,t)?null:a.jsxs("div",{className:"space-y-2",style:{gridColumn:e.colSpan?`span ${e.colSpan}`:"span 1",width:"100%"},children:[e.type!=="custom"&&a.jsxs($,{htmlFor:e.name,className:"text-sm font-medium",children:[e.label," ",e.required&&!(e.type==="file"&&m==="edit")&&a.jsx("span",{className:"text-red-500",children:"*"})]}),I(e),x[e.name]&&a.jsx("p",{className:"text-xs text-red-500",children:x[e.name]})]},e.name))}):O==="flex"?a.jsx("div",{className:"flex flex-wrap gap-4",children:l.fields.map(e=>e.conditional&&!e.conditional(m,t)?null:a.jsxs("div",{className:"space-y-2",style:{width:e.width||"100%",flexGrow:e.width?0:1},children:[e.type!=="custom"&&a.jsxs($,{htmlFor:e.name,className:"text-sm font-medium",children:[e.label," ",e.required&&!(e.type==="file"&&m==="edit")&&a.jsx("span",{className:"text-red-500",children:"*"})]}),I(e),x[e.name]&&a.jsx("p",{className:"text-xs text-red-500",children:x[e.name]})]},e.name))}):B().map(([e,r])=>a.jsx("div",{className:"flex flex-wrap gap-4 mb-4",children:r.map(c=>c.conditional&&!c.conditional(m,t)?null:a.jsxs("div",{className:"space-y-2",style:{width:c.width||"100%"},children:[c.type!=="custom"&&a.jsxs($,{htmlFor:c.name,className:"text-sm font-medium",children:[c.label," ",c.required&&!(c.type==="file"&&m==="edit")&&a.jsx("span",{className:"text-red-500",children:"*"})]}),I(c),x[c.name]&&a.jsx("p",{className:"text-xs text-red-500",children:x[c.name]})]},c.name))},e))]})}),a.jsxs(Z,{className:"sm:justify-end",children:[a.jsx(L,{type:"button",variant:"outline",onClick:p,children:d("Cancel")}),m!=="view"&&a.jsx(L,{type:"button",onClick:R,children:d("Save")})]})]})})}export{be as C};
