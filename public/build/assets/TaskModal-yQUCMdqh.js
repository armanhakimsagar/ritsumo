import{r as p,j as e}from"./ui-Ps9nvBG1.js";import{B as y,f as j,I,P as ne,M as ce,F as de,G as oe,u as me,D as xe,l as he,n as ue,o as ge,t as P}from"./app-BTt_gkO3.js";import{S as L,a as V,b as q,c as B,d as f}from"./select-z0EzYxFC.js";import{T as je,a as pe,b as $,c as H}from"./tabs-D83PhGuv.js";import{T as le}from"./textarea-DPiv_-Qc.js";import{D as W,a as G,b as J,c as k}from"./dropdown-menu-CvJwe1WI.js";import{E as K}from"./ellipsis-DhhTm3i6.js";import{S as ie}from"./square-pen-BE6Ef4zh.js";import{T as Q}from"./trash-2-WsAE_ige.js";import{M as re}from"./message-square-DGoN5Yg5.js";import{S as Ne}from"./send-B0OsKa7V.js";import{S as R}from"./square-check-big-B29hCoNu.js";import{S as ve}from"./square-DyzuZ8y2.js";import{U as fe}from"./user-DZ3jVi18.js";import{C as ye}from"./calendar-pZCS8WPy.js";import{C as _e}from"./CrudDeleteModal-CAwcbZOF.js";import{D as we}from"./download-FY3rJJBK.js";import{F as Se}from"./file-3AWHN2l6.js";import{P as Ce}from"./paperclip-h_SfHoPk.js";import"./vendor-B1hewrmX.js";/* empty css            *//* empty css                  */import"./utils-DVuJ_tgg.js";import"./index-C9qibMqK.js";import"./chevron-up-CaRG6751.js";function be({task:h,comments:x,currentUser:D,onUpdate:i}){const[u,v]=p.useState(""),[w,a]=p.useState(null),[s,o]=p.useState(""),c=r=>{r.preventDefault(),u.trim()&&j.post(route("task-comments.store",h.id),{comment:u,mentions:[]},{onSuccess:()=>{v(""),i==null||i()}})},S=r=>{a(r.id),o(r.comment)},g=r=>{j.put(route("task-comments.update",r),{comment:s,mentions:[]},{onSuccess:()=>{a(null),o(""),i==null||i()}})},C=r=>{confirm("Are you sure you want to delete this comment?")&&j.delete(route("task-comments.destroy",r),{onSuccess:()=>{i==null||i()}})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[x.map(r=>{var N;return e.jsx("div",{className:"flex space-x-3 p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium",children:(N=r.user)==null?void 0:N.name}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(r.created_at).toLocaleString()})]}),(r.can_update||r.can_delete)&&e.jsxs(W,{children:[e.jsx(G,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"sm",children:e.jsx(K,{className:"h-4 w-4"})})}),e.jsxs(J,{align:"end",className:"z-[9999]",children:[r.can_update&&e.jsxs(k,{onClick:()=>S(r),children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Edit"]}),r.can_delete&&e.jsxs(k,{onClick:()=>C(r.id),className:"text-red-600",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]}),w===r.id?e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{value:s,onChange:n=>o(n.target.value),rows:2}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(y,{size:"sm",onClick:()=>g(r.id),children:"Save"}),e.jsx(y,{size:"sm",variant:"outline",onClick:()=>a(null),children:"Cancel"})]})]}):e.jsx("p",{className:"text-sm text-gray-700",children:r.comment})]})},r.id)}),x.length===0&&e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(re,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No comments yet. Be the first to comment!"})]})]}),e.jsxs("form",{onSubmit:c,className:"space-y-3",children:[e.jsx(le,{value:u,onChange:r=>v(r.target.value),placeholder:"Add a comment...",rows:3}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(y,{type:"submit",size:"sm",disabled:!u.trim(),children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Post Comment"]})})]})]})}function ke({task:h,checklist:x,members:D,onUpdate:i}){const[u,v]=p.useState(""),[w,a]=p.useState(null),[s,o]=p.useState({title:"",assigned_to:"",due_date:""}),c=t=>{t.preventDefault(),u.trim()&&j.post(route("task-checklists.store",h.id),{title:u,assigned_to:"",due_date:""},{onSuccess:()=>{v(""),i==null||i()}})},S=t=>{j.post(route("task-checklists.toggle",t),{},{onSuccess:()=>{i==null||i()}})},g=t=>{var d,_;a(t.id),o({title:t.title,assigned_to:((_=(d=t.assigned_to)==null?void 0:d.id)==null?void 0:_.toString())||"",due_date:t.due_date||""})},C=t=>{j.put(route("task-checklists.update",t),s,{onSuccess:()=>{a(null),o({title:"",assigned_to:"",due_date:""}),i==null||i()}})},r=t=>{confirm("Are you sure you want to delete this checklist item?")&&j.delete(route("task-checklists.destroy",t),{onSuccess:()=>{i==null||i()}})},N=x.filter(t=>t.is_completed).length,n=x.length>0?N/x.length*100:0;return e.jsxs("div",{className:"space-y-4",children:[x.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Progress"}),e.jsxs("span",{className:"text-gray-600",children:[N,"/",x.length," completed"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full transition-all",style:{width:`${n}%`}})})]}),e.jsxs("div",{className:"space-y-2",children:[x.map(t=>e.jsxs("div",{className:"flex items-start space-x-3 p-3 border rounded-lg hover:bg-gray-50",children:[e.jsx("button",{onClick:()=>S(t.id),className:"mt-0.5 text-gray-400 hover:text-gray-600",children:t.is_completed?e.jsx(R,{className:"h-5 w-5 text-green-600"}):e.jsx(ve,{className:"h-5 w-5"})}),e.jsx("div",{className:"flex-1 min-w-0",children:w===t.id?e.jsxs("div",{className:"space-y-3",children:[e.jsx(I,{value:s.title,onChange:d=>o({...s,title:d.target.value}),placeholder:"Checklist item title"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(L,{value:s.assigned_to||"unassigned",onValueChange:d=>o({...s,assigned_to:d==="unassigned"?"":d}),children:[e.jsx(V,{children:e.jsx(q,{placeholder:"Assign to"})}),e.jsxs(B,{className:"z-[9999]",children:[e.jsx(f,{value:"unassigned",children:"Unassigned"}),D.map(d=>e.jsx(f,{value:d.id.toString(),children:d.name},d.id))]})]}),e.jsx(I,{type:"date",value:s.due_date,onChange:d=>o({...s,due_date:d.target.value})})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(y,{size:"sm",onClick:()=>C(t.id),children:"Save"}),e.jsx(y,{size:"sm",variant:"outline",onClick:()=>a(null),children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`text-sm ${t.is_completed?"line-through text-gray-500":"text-gray-900"}`,children:t.title}),(t.assigned_to||t.due_date)&&e.jsxs("div",{className:"flex items-center space-x-4 mt-1 text-xs text-gray-500",children:[t.assigned_to&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(fe,{className:"h-3 w-3"}),e.jsx("span",{children:t.assigned_to.name})]}),t.due_date&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ye,{className:"h-3 w-3"}),e.jsx("span",{children:new Date(t.due_date).toLocaleDateString()})]})]})]})}),(t.can_update||t.can_delete)&&e.jsxs(W,{children:[e.jsx(G,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"sm",children:e.jsx(K,{className:"h-4 w-4"})})}),e.jsxs(J,{align:"end",className:"z-[9999]",children:[t.can_update&&e.jsxs(k,{onClick:()=>g(t),children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Edit"]}),t.can_delete&&e.jsxs(k,{onClick:()=>r(t.id),className:"text-red-600",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]},t.id)),x.length===0&&e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(R,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No checklist items yet. Add your first item!"})]})]}),e.jsxs("form",{onSubmit:c,className:"flex space-x-2",children:[e.jsx(I,{value:u,onChange:t=>v(t.target.value),placeholder:"Add checklist item...",className:"flex-1"}),e.jsxs(y,{type:"submit",size:"sm",disabled:!u.trim(),children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Add"]})]})]})}function De({task:h,attachments:x,availableMedia:D=[],onUpdate:i}){var N;const[u,v]=p.useState(""),[w,a]=p.useState(!1),[s,o]=p.useState(null),c=(n,t)=>{v(n),t&&t.length>0&&j.post(route("task-attachments.store",h.id),{media_item_ids:t},{onSuccess:()=>{i==null||i(),v("")}})},S=n=>{window.open(route("task-attachments.download",n),"_blank")},g=n=>{o(n),a(!0)},C=()=>{s&&j.delete(route("task-attachments.destroy",s.id),{onSuccess:()=>{a(!1),o(null),i==null||i()},onError:()=>{a(!1),o(null)}})},r=n=>n.startsWith("image/")?de:n.includes("pdf")||n.includes("document")?oe:Se;return e.jsxs("div",{className:"space-y-4",children:[x.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:x.map(n=>{var _,T,M,E,z;const t=r(((_=n.media_item)==null?void 0:_.mime_type)||""),d=(M=(T=n.media_item)==null?void 0:T.mime_type)==null?void 0:M.startsWith("image/");return e.jsxs("div",{className:"relative group border rounded-lg overflow-hidden hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"aspect-square bg-gray-50 flex items-center justify-center",children:d&&((E=n.media_item)!=null&&E.thumb_url)?e.jsx("img",{src:n.media_item.thumb_url,alt:((z=n.media_item)==null?void 0:z.name)||"Attachment",className:"w-full h-full object-cover cursor-pointer",onClick:()=>{var b;return window.open(((b=n.media_item)==null?void 0:b.url)||n.media_item.thumb_url,"_blank")},onError:b=>{var A;(A=n.media_item)!=null&&A.url&&(b.currentTarget.src=n.media_item.url)}}):e.jsx(t,{className:"h-12 w-12 text-gray-400"})}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs(W,{children:[e.jsx(G,{asChild:!0,children:e.jsx(y,{variant:"secondary",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(K,{className:"h-4 w-4"})})}),e.jsxs(J,{align:"end",className:"z-[9999]",children:[e.jsxs(k,{onClick:()=>S(n.id),children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Download"]}),e.jsxs(k,{onClick:()=>g(n),className:"text-red-600",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Remove"]})]})]})})]},n.id)})}),e.jsx("div",{children:e.jsx(ce,{label:"Add Media",value:u,onChange:c,placeholder:"Select media...",showPreview:!0})}),e.jsx(_e,{isOpen:w,onClose:()=>{a(!1),o(null)},onConfirm:C,itemName:((N=s==null?void 0:s.media_item)==null?void 0:N.name)||"attachment",entityName:"attachment"})]})}function es({task:h,isOpen:x,onClose:D,members:i,stages:u,milestones:v,permissions:w}){var d,_,T,M,E,z,b,A,X,Y,Z,U,ee,se,te;const{t:a}=me(),[s,o]=p.useState(h),[c,S]=p.useState(w),g=async()=>{try{const m=await(await fetch(route("tasks.show",h.id))).json();o(m.task),S(m.permissions)}catch(l){console.error("Failed to refresh task:",l)}},C=l=>{j.put(route("tasks.change-stage",h.id),{task_stage_id:l},{onSuccess:()=>{g()},onError:()=>{P.error("Failed to update stage")}})},r=l=>{var m;j.put(route("tasks.update",h.id),{title:s.title,description:s.description||"",priority:l,start_date:s.start_date,end_date:s.end_date,assigned_to:(m=s.assigned_to)==null?void 0:m.id,milestone_id:s.milestone_id},{onSuccess:()=>{g()},onError:()=>{P.error("Failed to update priority")}})},N=l=>{const m=l==="unassigned"?null:parseInt(l);j.put(route("tasks.update",h.id),{title:s.title,description:s.description||"",priority:s.priority,start_date:s.start_date,end_date:s.end_date,assigned_to:m,milestone_id:s.milestone_id},{onSuccess:()=>{g()},onError:()=>{P.error("Failed to update assignee")}})},n=(l,m)=>{var F;j.put(route("tasks.update",h.id),{title:s.title,description:s.description||"",priority:s.priority,start_date:l==="start_date"?m||null:s.start_date,end_date:l==="end_date"?m||null:s.end_date,assigned_to:(F=s.assigned_to)==null?void 0:F.id,milestone_id:s.milestone_id},{onSuccess:()=>{g()},onError:()=>{P.error("Failed to update date")}})},t=l=>{switch(l){case"critical":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return e.jsx(xe,{open:x,onOpenChange:D,children:e.jsxs(he,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ue,{children:e.jsx(ge,{children:s.title})}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{className:"col-span-2 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:a("Description")}),e.jsx("div",{className:"text-sm text-gray-600",children:s.description||a("No description provided")})]}),e.jsxs(je,{defaultValue:"comments",className:"w-full",children:[e.jsxs(pe,{children:[e.jsxs($,{value:"comments",className:"flex items-center space-x-2",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsxs("span",{children:[a("Comments")," (",((d=h.comments)==null?void 0:d.length)||0,")"]})]}),e.jsxs($,{value:"checklist",className:"flex items-center space-x-2",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsxs("span",{children:[a("Checklist")," (",((_=h.checklists)==null?void 0:_.length)||0,")"]})]}),e.jsxs($,{value:"attachments",className:"flex items-center space-x-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsxs("span",{children:[a("Files")," (",((T=s.attachments)==null?void 0:T.length)||0,")"]})]})]}),e.jsx(H,{value:"comments",className:"space-y-4",children:e.jsx(be,{task:s,comments:s.comments||[],currentUser:i[0],onUpdate:g})}),e.jsx(H,{value:"checklist",className:"space-y-4",children:e.jsx(ke,{task:s,checklist:s.checklists||[],members:((E=(M=s.project)==null?void 0:M.members)==null?void 0:E.filter(l=>{var m;return((m=l.user)==null?void 0:m.type)!=="client"}).map(l=>l.user))||i,onUpdate:g})}),e.jsx(H,{value:"attachments",className:"space-y-4",children:e.jsx(De,{task:s,attachments:s.attachments||[],availableMedia:((b=(z=s.project)==null?void 0:z.workspace)==null?void 0:b.media)||[],onUpdate:g})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:a("Stage")}),c!=null&&c.change_status?e.jsxs(L,{value:s.task_stage_id.toString(),onValueChange:C,children:[e.jsx(V,{children:e.jsx(q,{})}),e.jsx(B,{className:"z-[9999]",children:u.map(l=>e.jsx(f,{value:l.id.toString(),children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:l.color}}),e.jsx("span",{children:l.name})]})},l.id))})]}):e.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-gray-50 rounded",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:(A=s.task_stage)==null?void 0:A.color}}),e.jsx("span",{children:(X=s.task_stage)==null?void 0:X.name})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:a("Priority")}),c!=null&&c.update?e.jsxs(L,{value:s.priority,onValueChange:r,children:[e.jsx(V,{children:e.jsx(q,{})}),e.jsxs(B,{className:"z-[9999]",children:[e.jsx(f,{value:"low",children:a("Low")}),e.jsx(f,{value:"medium",children:a("Medium")}),e.jsx(f,{value:"high",children:a("High")}),e.jsx(f,{value:"critical",children:a("Critical")})]})]}):e.jsx("div",{className:`inline-flex px-2 py-1 rounded text-sm ${t(s.priority)}`,children:s.priority})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:a("Assignee")}),c!=null&&c.assign_users?e.jsxs(L,{value:((Z=(Y=s.assigned_to)==null?void 0:Y.id)==null?void 0:Z.toString())||"unassigned",onValueChange:N,children:[e.jsx(V,{children:e.jsx(q,{placeholder:a("Select assignee")})}),e.jsxs(B,{className:"z-[9999]",children:[e.jsx(f,{value:"unassigned",children:a("Unassigned")}),(()=>{var m,F;const l=((F=(m=s.project)==null?void 0:m.members)==null?void 0:F.filter(O=>{var ae;return((ae=O.user)==null?void 0:ae.type)!=="client"}).map(O=>O.user))||[];return l.length>0?l:i})().map(l=>e.jsx(f,{value:l.id.toString(),children:l.name},l.id))]})]}):e.jsx("div",{className:"text-sm text-gray-600",children:((U=s.assigned_to)==null?void 0:U.name)||a("Unassigned")})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:a("Dates")}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500",children:a("Start Date")}),c!=null&&c.update?e.jsx(I,{type:"date",value:((ee=s.start_date)==null?void 0:ee.split("T")[0])||"",onChange:l=>n("start_date",l.target.value),className:"mt-1"}):e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:s.start_date?new Date(s.start_date).toLocaleDateString():a("Not set")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500",children:a("Due Date")}),c!=null&&c.update?e.jsx(I,{type:"date",value:((se=s.end_date)==null?void 0:se.split("T")[0])||"",onChange:l=>n("end_date",l.target.value),className:"mt-1"}):e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:s.end_date?new Date(s.end_date).toLocaleDateString():a("Not set")})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:a("Progress")}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("span",{className:"text-sm text-gray-600",children:[s.progress,"%"]})}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${s.progress}%`}})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:a("Project")}),e.jsx("span",{className:"text-sm text-gray-600",children:(te=s.project)==null?void 0:te.title}),s.milestone&&e.jsxs("div",{className:"mt-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:a("Milestone")}),e.jsx("span",{className:"text-sm text-gray-600",children:s.milestone.title})]})]})]})]})]})})}export{es as default};
