import{r as o,j as e}from"./ui-Ps9nvBG1.js";import{D as z,l as B,n as V,o as A,e as l,I as u,B as k,X as H,r as $,f as L}from"./app-BTt_gkO3.js";import{S as C,a as T,b as y,c as I,d as _}from"./select-z0EzYxFC.js";import{T as R}from"./textarea-DPiv_-Qc.js";import{C as U}from"./checkbox-ux8-2I9a.js";import{C as W}from"./clock-NAV_RQL_.js";function Y({isOpen:g,onClose:p,timeEntry:i,timesheetId:F,projects:b,selectedDate:f}){var N;const[t,r]=o.useState({project_id:"",task_id:"",date:((N=window.appSettings)==null?void 0:N.formatDateForInput(new Date))||new Date().toISOString().split("T")[0],start_time:"",end_time:"",hours:"",description:"",is_billable:!0}),[h,S]=o.useState(!1),[n,x]=o.useState("duration"),[v,w]=o.useState({});o.useEffect(()=>{var s,a,c;if(i)r({project_id:i.project_id.toString(),task_id:((s=i.task_id)==null?void 0:s.toString())||"none",date:((a=window.appSettings)==null?void 0:a.formatDateForInput(i.date))||i.date,start_time:i.start_time||"",end_time:i.end_time||"",hours:i.hours.toString(),description:i.description||"",is_billable:i.is_billable}),x(i.start_time?"times":"duration");else{const m=f||((c=window.appSettings)==null?void 0:c.formatDateForInput(new Date))||new Date().toISOString().split("T")[0];r({project_id:"",task_id:"none",date:m,start_time:"",end_time:"",hours:"",description:"",is_billable:!0})}},[i,g,f]);const O=s=>{s.preventDefault(),S(!0);const a={timesheet_id:F,project_id:t.project_id,task_id:t.task_id==="none"?null:t.task_id||null,date:t.date,start_time:n==="times"?t.start_time:null,end_time:n==="times"?t.end_time:null,hours:parseFloat(t.hours),description:t.description,is_billable:t.is_billable},c=i?route("timesheet-entries.update",i.id):route("timesheet-entries.store");L[i?"put":"post"](c,a,{onSuccess:()=>{var d;w({}),p(),r({project_id:"",task_id:"none",date:((d=window.appSettings)==null?void 0:d.formatDateForInput(new Date))||new Date().toISOString().split("T")[0],start_time:"",end_time:"",hours:"",description:"",is_billable:!0})},onError:d=>w(d),onFinish:()=>S(!1)})},q=()=>{if(t.start_time&&t.end_time){const s=new Date(`2000-01-01T${t.start_time}`),m=(new Date(`2000-01-01T${t.end_time}`).getTime()-s.getTime())/(1e3*60*60);r(d=>({...d,hours:(()=>{var D;return typeof window<"u"&&((D=window.appSettings)!=null&&D.formatCurrency)?window.appSettings.formatCurrency(m,{showSymbol:!0}):m.toFixed(2)})()}))}};o.useEffect(()=>{n==="times"&&q()},[t.start_time,t.end_time,n]);const j=b.find(s=>s.id.toString()===t.project_id),M=(j==null?void 0:j.tasks)||[];return e.jsx(z,{open:g,onOpenChange:p,children:e.jsxs(B,{className:"sm:max-w-lg",style:{zIndex:9999},children:[e.jsx(V,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"}),i?"Edit Time Entry":"Add Time Entry"]})}),Object.keys(v).length>0&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsx("ul",{className:"text-red-700 text-sm space-y-1",children:Object.values(v).map((s,a)=>e.jsxs("li",{children:["â€¢ ",s]},a))})}),e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Project *"}),e.jsxs(C,{value:t.project_id,onValueChange:s=>r(a=>({...a,project_id:s,task_id:"none"})),children:[e.jsx(T,{children:e.jsx(y,{placeholder:"Select project"})}),e.jsx(I,{style:{zIndex:999999},children:b.map(s=>e.jsx(_,{value:s.id.toString(),children:s.title},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Task"}),e.jsxs(C,{value:t.task_id,onValueChange:s=>r(a=>({...a,task_id:s})),children:[e.jsx(T,{children:e.jsx(y,{placeholder:"Select task (optional)"})}),e.jsxs(I,{style:{zIndex:999999},children:[e.jsx(_,{value:"none",children:"No task"}),M.map(s=>e.jsx(_,{value:s.id.toString(),children:s.title},s.id))]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Date *"}),e.jsx(u,{type:"date",value:t.date,onChange:s=>r(a=>({...a,date:s.target.value})),required:!0})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",checked:n==="duration",onChange:()=>x("duration")}),e.jsx("span",{children:"Duration"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",checked:n==="times",onChange:()=>x("times")}),e.jsx("span",{children:"Start/End Times"})]})]}),n==="duration"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Hours *"}),e.jsx(u,{type:"number",step:"0.25",min:"0.25",max:"24",value:t.hours,onChange:s=>r(a=>({...a,hours:s.target.value})),placeholder:"8.00",required:!0})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Start Time *"}),e.jsx(u,{type:"time",value:t.start_time,onChange:s=>r(a=>({...a,start_time:s.target.value})),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"End Time *"}),e.jsx(u,{type:"time",value:t.end_time,onChange:s=>r(a=>({...a,end_time:s.target.value})),required:!0})]})]}),n==="times"&&t.hours&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Calculated hours: ",t.hours]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Description"}),e.jsx(R,{value:t.description,onChange:s=>r(a=>({...a,description:s.target.value})),placeholder:"What did you work on?",rows:3})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{id:"is_billable",checked:t.is_billable,onCheckedChange:s=>r(a=>({...a,is_billable:!!s}))}),e.jsx(l,{htmlFor:"is_billable",children:"Billable"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsxs(k,{type:"button",variant:"outline",onClick:p,disabled:h,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs(k,{type:"submit",disabled:h||!t.project_id||!t.hours,children:[e.jsx($,{className:"h-4 w-4 mr-2"}),h?"Saving...":i?"Update":"Add Entry"]})]})]})]})})}export{Y as T};
