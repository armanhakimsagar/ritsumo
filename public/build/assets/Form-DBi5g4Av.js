import{r as m,j as e}from"./ui-Ps9nvBG1.js";import{u as Z,e as i,I as p,C as U,a as X,b as B,B as _,P as ee,d as L,f as F}from"./app-BTt_gkO3.js";import{P as te}from"./page-template-BeQadk1c.js";import{T as w}from"./textarea-DPiv_-Qc.js";import{S as D,a as v,b as E,c as P,d as h}from"./select-z0EzYxFC.js";import{f}from"./currency-kzm_C5pv.js";import{T as se}from"./trash-2-WsAE_ige.js";import"./vendor-B1hewrmX.js";/* empty css            *//* empty css                  */import"./utils-DVuJ_tgg.js";import"./react-country-flag.esm-2v5ikZ5v.js";import"./language-BbwPiY59.js";import"./loader-circle-LF6za7Wc.js";import"./trending-up-BkxnV74k.js";import"./language-switcher-AzCP_3T2.js";import"./switch-DG4amuEJ.js";import"./dropdown-menu-CvJwe1WI.js";import"./globe-BYIVGjA8.js";import"./chevron-up-CaRG6751.js";import"./building-2-CVOsE0mA.js";import"./square-check-big-B29hCoNu.js";import"./bug-DP5pb0Nw.js";import"./clock-NAV_RQL_.js";import"./credit-card-BwPrmecT.js";import"./dollar-sign-CY6xo33T.js";import"./mail-CZ8KgBhk.js";import"./message-square-DGoN5Yg5.js";import"./settings-CG31wyPI.js";import"./user-DZ3jVi18.js";import"./triangle-alert-BuDHDWvi.js";import"./use-favicon-vjALIuby.js";import"./index-C9qibMqK.js";function Re({invoice:s,projects:y,clients:x,currencies:ae}){var O,V,H;const{t:a}=Z(),u=!!s,[r,G]=m.useState({project_id:((O=s==null?void 0:s.project_id)==null?void 0:O.toString())||"",client_id:((V=s==null?void 0:s.client_id)==null?void 0:V.toString())||"",title:(s==null?void 0:s.title)||"",description:(s==null?void 0:s.description)||"",invoice_date:s!=null&&s.invoice_date?new Date(s.invoice_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],due_date:s!=null&&s.due_date?new Date(s.due_date).toISOString().split("T")[0]:"",tax_rate:(s==null?void 0:s.tax_rate)||0,discount_amount:(s==null?void 0:s.discount_amount)||0,currency:(s==null?void 0:s.currency)||"USD",notes:(s==null?void 0:s.notes)||"",terms:(s==null?void 0:s.terms)||""}),[c,N]=m.useState(((H=s==null?void 0:s.items)==null?void 0:H.map(t=>({type:"task",description:t.description||"",rate:t.rate||0,amount:t.amount||0,task_id:t.task_id})))||[{type:"task",description:"",rate:0,amount:0,task_id:null}]),[q,b]=m.useState(!1),[$,C]=m.useState([]),[re,S]=m.useState([]),[I,j]=m.useState([]),K=[{title:a("Dashboard"),href:route("dashboard")},{title:a("Invoices"),href:route("invoices.index")},{title:u?`${a("Edit")} ${s.invoice_number}`:a("Create Invoice")}];m.useEffect(()=>{r.project_id&&z(r.project_id),j(x||[])},[]);const o=(t,l)=>{G(n=>({...n,[t]:l})),t==="project_id"&&l?z(l):t==="project_id"&&!l&&(C([]),S([]),j(x||[]))},z=async t=>{var l;try{const n=await fetch(route("api.projects.invoice-data",t),{method:"GET",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content"))||"","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const d=await n.json();C(d.tasks||[]),S(d.clients||[]);const k=[...d.clients||[]],Y=k.map(g=>g.id);x.forEach(g=>{Y.includes(g.id)||k.push(g)}),j(k)}catch(n){console.error("Failed to load project data:",n),C([]),S([]),j(x||[])}},A=(t,l,n)=>{const d=[...c];d[t]={...d[t],[l]:n},N(d)},M=()=>{N([...c,{type:"task",description:"",rate:0,amount:0,task_id:null}])},W=t=>{c.length>1&&N(c.filter((l,n)=>n!==t))},T=()=>c.reduce((t,l)=>t+(Number(l.amount)||0),0),R=()=>T()*(Number(r.tax_rate)||0)/100,J=()=>T()+R()-(Number(r.discount_amount)||0),Q=t=>{t.preventDefault(),b(!0);const l={...r,client_id:r.client_id==="none"?null:r.client_id,items:c.filter(n=>n.task_id!==null&&n.task_id!=="no-tasks")};u?F.put(route("invoices.update",s.id),l,{onFinish:()=>b(!1)}):F.post(route("invoices.store"),l,{onFinish:()=>b(!1)})};return e.jsx(te,{title:u?`${a("Edit Invoice")} ${s.invoice_number}`:a("Create Invoice"),url:u?`/invoices/${s.id}/edit`:"/invoices/create",breadcrumbs:K,children:e.jsxs("form",{onSubmit:Q,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"project_id",children:[a("Project")," *"]}),e.jsxs(D,{value:r.project_id,onValueChange:t=>o("project_id",t),children:[e.jsx(v,{children:e.jsx(E,{placeholder:a("Select project")})}),e.jsx(P,{className:"z-[9999]",children:y==null?void 0:y.map(t=>e.jsx(h,{value:t.id.toString(),children:t.title},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"client_id",children:a("Client")}),e.jsxs(D,{value:r.client_id,onValueChange:t=>o("client_id",t),children:[e.jsx(v,{children:e.jsx(E,{placeholder:a("Select client (optional)")})}),e.jsxs(P,{className:"z-[9999]",children:[e.jsx(h,{value:"none",children:a("No client")}),I==null?void 0:I.map(t=>e.jsx(h,{value:t.id.toString(),children:t.name},t.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"title",children:[a("Invoice Title")," *"]}),e.jsx(p,{id:"title",value:r.title,onChange:t=>o("title",t.target.value),placeholder:a("Enter invoice title"),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"invoice_date",children:[a("Invoice Date")," *"]}),e.jsx(p,{id:"invoice_date",type:"date",value:r.invoice_date,onChange:t=>o("invoice_date",t.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"due_date",children:[a("Due Date")," *"]}),e.jsx(p,{id:"due_date",type:"date",value:r.due_date,onChange:t=>o("due_date",t.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"description",children:a("Description")}),e.jsx(w,{id:"description",value:r.description,onChange:t=>o("description",t.target.value),placeholder:a("Enter invoice description"),rows:3})]}),e.jsxs(U,{children:[e.jsx(X,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(B,{children:a("Invoice Items")}),e.jsxs(_,{type:"button",onClick:M,size:"sm",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),a("Add Item")]})]})}),e.jsx(L,{children:e.jsx("div",{className:"space-y-4",children:c.map((t,l)=>{var n;return e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-end",children:[e.jsxs("div",{className:"col-span-8",children:[e.jsx(i,{children:a("Task")}),e.jsxs(D,{value:((n=t.task_id)==null?void 0:n.toString())||"",onValueChange:d=>A(l,"task_id",d?parseInt(d):null),children:[e.jsx(v,{children:e.jsx(E,{placeholder:a("Select task")})}),e.jsxs(P,{className:"z-[9999]",children:[$.map(d=>e.jsx(h,{value:d.id.toString(),children:d.title},d.id)),$.length===0&&e.jsx(h,{value:"no-tasks",disabled:!0,children:r.project_id?a("No tasks found"):a("Select project first")})]})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(i,{children:a("Amount")}),e.jsx(p,{type:"number",step:"0.01",min:"0",value:t.amount,onChange:d=>A(l,"amount",parseFloat(d.target.value)||0)})]}),e.jsx("div",{className:"col-span-2",children:e.jsx(_,{type:"button",variant:"outline",size:"icon",onClick:()=>W(l),disabled:c.length===1,children:e.jsx(se,{className:"h-4 w-4"})})})]},l)})})})]}),e.jsxs(U,{children:[e.jsx(X,{children:e.jsx(B,{children:a("Totals")})}),e.jsxs(L,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"tax_rate",children:[a("Tax Rate")," (%)"]}),e.jsx(p,{id:"tax_rate",type:"number",step:"0.01",min:"0",max:"100",value:r.tax_rate,onChange:t=>o("tax_rate",parseFloat(t.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"discount_amount",children:a("Discount Amount")}),e.jsx(p,{id:"discount_amount",type:"number",step:"0.01",min:"0",value:r.discount_amount,onChange:t=>o("discount_amount",parseFloat(t.target.value)||0)})]})]}),e.jsxs("div",{className:"mt-4 space-y-2 text-right",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[a("Subtotal"),":"]}),e.jsx("span",{children:f(T())})]}),r.tax_rate>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[a("Tax")," (",r.tax_rate,"%):"]}),e.jsx("span",{children:f(R())})]}),r.discount_amount>0&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsxs("span",{children:[a("Discount"),":"]}),e.jsxs("span",{children:["-",f(Number(r.discount_amount))]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg border-t pt-2",children:[e.jsxs("span",{children:[a("Total"),":"]}),e.jsx("span",{children:f(J())})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"notes",children:a("Notes")}),e.jsx(w,{id:"notes",value:r.notes,onChange:t=>o("notes",t.target.value),placeholder:a("Internal notes"),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"terms",children:a("Terms & Conditions")}),e.jsx(w,{id:"terms",value:r.terms,onChange:t=>o("terms",t.target.value),placeholder:a("Payment terms and conditions"),rows:3})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(_,{type:"button",variant:"outline",onClick:()=>F.visit(route("invoices.index")),children:a("Cancel")}),e.jsx(_,{type:"submit",disabled:q,children:a(q?u?"Updating...":"Creating...":u?"Update Invoice":"Create Invoice")})]})]})})}export{Re as default};
