import{r as x,j as e}from"./ui-Ps9nvBG1.js";import{D as z,l as B,n as V,o as A,g as I,e as c,I as m,B as T,f}from"./app-BTt_gkO3.js";import{T as H}from"./textarea-DPiv_-Qc.js";import{S,a as y,b as k,c as C,d as g}from"./select-z0EzYxFC.js";function J({isOpen:h,onClose:_,expense:i,projects:D,mode:r,currentProject:s,redirectUrl:N}){const[a,d]=x.useState({project_id:"",budget_category_id:"",task_id:"",amount:"",expense_date:new Date().toISOString().split("T")[0],title:"",description:""}),[E,j]=x.useState([]),[F,p]=x.useState([]);x.useEffect(()=>{var t,n;if(r==="edit"&&i&&h){const u=i.expense_date.includes("T")?i.expense_date.split("T")[0]:i.expense_date;d({project_id:i.project_id.toString(),budget_category_id:((t=i.budget_category_id)==null?void 0:t.toString())||"none",task_id:((n=i.task_id)==null?void 0:n.toString())||"none",amount:i.amount.toString(),expense_date:u,title:i.title||"",description:i.description||""}),b(i.project_id)}else if(r==="create"&&h){const u=s?s.id.toString():"";d({project_id:u,budget_category_id:"none",task_id:"none",amount:"",expense_date:new Date().toISOString().split("T")[0],title:"",description:""}),s?b(s.id):(j([]),p([]))}},[r,i,h,s]);const b=async t=>{var n,u;if(s&&s.id===t&&((n=s.budget)!=null&&n.categories))j(s.budget.categories);else{const o=D.find(v=>v.id===t);j(((u=o==null?void 0:o.budget)==null?void 0:u.categories)||[])}try{const o=await fetch(route("api.projects.tasks",t));if(o.ok){const v=await o.json();p(v)}}catch{p([])}},w=t=>{d({...a,project_id:t,budget_category_id:"none",task_id:"none"}),t?b(parseInt(t)):(j([]),p([]))},q=t=>{t.preventDefault();const n={project_id:a.project_id,budget_category_id:a.budget_category_id==="none"?null:a.budget_category_id,task_id:a.task_id==="none"?null:a.task_id,amount:parseFloat(a.amount),expense_date:a.expense_date,title:a.title,description:a.description};r==="create"?f.post(route("expenses.store"),n,{onSuccess:()=>{_(),N&&f.get(N)}}):i&&f.put(route("expenses.update",i.id),n,{onSuccess:()=>_()})},l=!i||i.status==="pending"||i.status==="requires_info";return e.jsx(z,{open:h,onOpenChange:_,children:e.jsxs(B,{className:"max-w-2xl z-50",children:[e.jsx(V,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(A,{children:r==="create"?"Create Expense":"Edit Expense"}),(i==null?void 0:i.status)&&e.jsx(I,{variant:"secondary",children:i.status})]})}),e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"project_id",children:"Project *"}),s?e.jsx(m,{value:s.title,disabled:!0,className:"bg-gray-50"}):e.jsxs(S,{value:a.project_id,onValueChange:w,disabled:!l||r==="edit",children:[e.jsx(y,{children:e.jsx(k,{placeholder:"Select project"})}),e.jsx(C,{className:"z-[60]",children:D.map(t=>e.jsx(g,{value:t.id.toString(),children:t.title},t.id))})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"budget_category_id",children:"Budget Category"}),e.jsxs(S,{value:a.budget_category_id,onValueChange:t=>d({...a,budget_category_id:t}),disabled:!l||!a.project_id,children:[e.jsx(y,{children:e.jsx(k,{placeholder:a.project_id?"Select category (optional)":"Select project first"})}),e.jsxs(C,{className:"z-[60]",children:[e.jsx(g,{value:"none",children:"No category"}),E.map(t=>e.jsx(g,{value:t.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),t.name]})},t.id))]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"task_id",children:"Task"}),e.jsxs(S,{value:a.task_id,onValueChange:t=>d({...a,task_id:t}),disabled:!l||!a.project_id,children:[e.jsx(y,{children:e.jsx(k,{placeholder:a.project_id?"Select task (optional)":"Select project first"})}),e.jsxs(C,{className:"z-[60]",children:[e.jsx(g,{value:"none",children:"No task"}),F.map(t=>e.jsx(g,{value:t.id.toString(),children:t.title},t.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"title",children:"Title *"}),e.jsx(m,{id:"title",value:a.title,onChange:t=>d({...a,title:t.target.value}),disabled:!l,required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"amount",children:"Amount *"}),e.jsx(m,{id:"amount",type:"number",step:"0.01",value:a.amount,onChange:t=>d({...a,amount:t.target.value}),disabled:!l,required:!0})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"expense_date",children:"Date *"}),e.jsx(m,{id:"expense_date",type:"date",value:a.expense_date,onChange:t=>d({...a,expense_date:t.target.value}),disabled:!l,required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"description",children:"Description"}),e.jsx(H,{id:"description",value:a.description,onChange:t=>d({...a,description:t.target.value}),rows:3,disabled:!l})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(T,{type:"button",variant:"outline",onClick:_,children:"Cancel"}),l&&e.jsx(T,{type:"submit",children:r==="create"?"Create Expense":"Update Expense"})]})]})]})})}export{J as E};
