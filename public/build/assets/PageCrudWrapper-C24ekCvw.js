import{r as j,j as t}from"./ui-Ps9nvBG1.js";import{P as ue}from"./page-template-BeQadk1c.js";import{u as fe,K as he,h as K,P as ge,S as L,I as je,B as N,e as R,f,t as n}from"./app-BTt_gkO3.js";import{S as H,a as W,b as G,c as J,d as v}from"./select-z0EzYxFC.js";import{C as xe}from"./CrudTable-Dq4zN5Ad.js";import{C as be}from"./CrudFormModal-CIUswiAq.js";import{E as Se}from"./EnhancedDeleteModal-BUN-gSW9.js";import{F as ve}from"./filter-C99mLYzj.js";function _e({config:w,title:Q,url:X,buttons:D=[],breadcrumbs:Y}){var I,q;const{t:c}=fe(),{entity:a,table:F,filters:S=[],form:C,hooks:o}=w,{auth:y,...T}=he().props,$=(y==null?void 0:y.permissions)||[],b=T[a.name]||{data:[],links:[]},m=T.filters||{},[p,M]=j.useState(m.search||""),[x,A]=j.useState({}),[O,z]=j.useState(!1),[Z,g]=j.useState(!1),[k,_]=j.useState(!1),[u,B]=j.useState(null),[h,E]=j.useState("create");j.useEffect(()=>{const e={};S.forEach(s=>{const l=s.name||s.key;e[l]=m[l]||""}),A(e)},[]);const U=()=>Object.entries(x).some(([e,s])=>s&&s!=="")||p!=="",ee=()=>Object.entries(x).filter(([e,s])=>s&&s!=="").length+(p?1:0),se=e=>{e.preventDefault(),ae()},ae=()=>{const e={page:1};p&&(e.search=p),Object.entries(x).forEach(([s,l])=>{l&&l!==""&&(e[s]=l)}),m.per_page&&(e.per_page=m.per_page),f.get(a.endpoint,e,{preserveState:!0,preserveScroll:!0})},te=(e,s)=>{A(d=>({...d,[e]:s}));const l={page:1};p&&(l.search=p);const r={...x,[e]:s};Object.entries(r).forEach(([d,i])=>{i&&i!==""&&(l[d]=i)}),m.per_page&&(l.per_page=m.per_page),f.get(a.endpoint,l,{preserveState:!0,preserveScroll:!0})},re=e=>{const s=m.sort_field===e&&m.sort_direction==="asc"?"desc":"asc",l={sort_field:e,sort_direction:s,page:1};p&&(l.search=p),Object.entries(x).forEach(([r,d])=>{d&&d!==""&&(l[r]=d)}),m.per_page&&(l.per_page=m.per_page),f.get(a.endpoint,l,{preserveState:!0,preserveScroll:!0})},ie=(e,s)=>{switch(B(s),e){case"view":E("view"),g(!0);break;case"edit":E("edit"),g(!0);break;case"delete":_(!0);break}},le=()=>{B(null),E("create"),g(!0)},ne=e=>{const s={...e};if(a.name==="roles"){if(s.permissions&&Array.isArray(s.permissions)){const d=s.permissions.map(i=>typeof i=="object"&&i!==null&&i.name?i.name:String(i));s.permissions=d}const r={label:s.label,description:s.description||"",permissions:s.permissions||[]};Object.keys(s).forEach(d=>{delete s[d]}),Object.assign(s,r)}else if(s.permissions&&Array.isArray(s.permissions)){const r={};s.permissions.forEach((d,i)=>{r[i]=String(d)}),s.permissions=r}if(a.name==="permissions"&&h==="edit"&&delete s.name,C.fields.some(r=>r.type==="file")){const r=C.fields.filter(i=>i.type==="file").map(i=>i.name),d=new FormData;Object.keys(s).forEach(i=>{if(r.includes(i)&&h==="edit"){s[i]&&typeof s[i]=="object"&&d.append(i,s[i]);return}d.append(i,s[i])}),h==="create"?(n.loading(c("Creating...")),f.post(a.endpoint,d,{onSuccess:i=>{g(!1),n.dismiss(),n.success(c(`${a.name.slice(0,-1).charAt(0).toUpperCase()+a.name.slice(0,-1).slice(1)} created successfully`)),o!=null&&o.afterCreate&&o.afterCreate(e,i.props[a.name])},onError:i=>{n.dismiss(),n.error(c(`Failed to create ${a.name.slice(0,-1)}: ${Object.values(i).join(", ")}`))}})):h==="edit"&&(n.loading(c("Updating...")),f.post(`${a.endpoint}/${u.id}?_method=PUT`,d,{onSuccess:i=>{g(!1),n.dismiss(),n.success(c(`${a.name.slice(0,-1).charAt(0).toUpperCase()+a.name.slice(0,-1).slice(1)} updated successfully`)),o!=null&&o.afterUpdate&&o.afterUpdate(e,i.props[a.name])},onError:i=>{n.dismiss(),n.error(c(`Failed to update ${a.name.slice(0,-1)}: ${Object.values(i).join(", ")}`))}}));return}h==="create"?(n.loading(c("Creating...")),f.post(a.endpoint,s,{onSuccess:r=>{g(!1),n.dismiss(),n.success(c(`${a.name.slice(0,-1).charAt(0).toUpperCase()+a.name.slice(0,-1).slice(1)} created successfully`)),o!=null&&o.afterCreate&&o.afterCreate(e,r.props[a.name])},onError:r=>{n.dismiss(),n.error(c(`Failed to create ${a.name.slice(0,-1)}: ${Object.values(r).join(", ")}`))}})):h==="edit"&&(n.loading(c("Updating...")),f.put(`${a.endpoint}/${u.id}`,s,{onSuccess:r=>{g(!1),n.dismiss(),n.success(c(`${a.name.slice(0,-1).charAt(0).toUpperCase()+a.name.slice(0,-1).slice(1)} updated successfully`)),o!=null&&o.afterUpdate&&o.afterUpdate(e,r.props[a.name])},onError:r=>{n.dismiss(),n.error(c(`Failed to update ${a.name.slice(0,-1)}: ${Object.values(r).join(", ")}`))}}))},ce=()=>{n.loading(c("Deleting...")),f.delete(`${a.endpoint}/${u.id}`,{onSuccess:()=>{_(!1),n.dismiss(),n.success(c(`${a.name.slice(0,-1).charAt(0).toUpperCase()+a.name.slice(0,-1).slice(1)} deleted successfully`)),o!=null&&o.afterDelete&&o.afterDelete(u.id)},onError:e=>{n.dismiss(),n.error(c(`Failed to delete ${a.name.slice(0,-1)}: ${Object.values(e).join(", ")}`))}})},oe=()=>{const e={};S.forEach(s=>{e[s.key]=s.type==="select"?"all":""}),A(e),M(""),z(!1),f.get(a.endpoint,{page:1,per_page:m.per_page},{preserveState:!0,preserveScroll:!0})},de=D.every(e=>e.showAddButton!==!1),P=[];D.forEach(e=>{(!e.permission||K($,e.permission))&&P.push({label:e.label,icon:e.icon,variant:e.variant,onClick:e.onClick})}),de&&K($,a.permissions.create)&&P.push({label:`Add New ${a.name.slice(0,-1).charAt(0).toUpperCase()+a.name.slice(0,-1).slice(1)}`,icon:t.jsx(ge,{className:"h-4 w-4"}),variant:"default",onClick:()=>le()});const V=Q||a.name.charAt(0).toUpperCase()+a.name.slice(1),me=[{title:c("Dashboard"),href:route("dashboard")},{title:V}],pe=Y||me;return t.jsxs(ue,{title:V,url:X,actions:P,breadcrumbs:pe,noPadding:!0,children:[t.jsx("div",{className:"bg-white rounded-lg shadow mb-4",children:t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("form",{onSubmit:se,className:"flex gap-2",children:[t.jsxs("div",{className:"relative w-64",children:[t.jsx(L,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),t.jsx(je,{placeholder:`Search ${a.name}...`,value:p,onChange:e=>M(e.target.value),className:"w-full pl-9"})]}),t.jsxs(N,{type:"submit",size:"sm",children:[t.jsx(L,{className:"h-4 w-4 mr-1.5"}),c("Search")]})]}),S.length>0&&t.jsx("div",{className:"ml-2",children:t.jsxs(N,{variant:U()?"default":"outline",size:"sm",className:"h-8 px-2 py-1",onClick:()=>z(!O),children:[t.jsx(ve,{className:"h-3.5 w-3.5 mr-1.5"}),O?"Hide Filters":"Filters",U()&&t.jsx("span",{className:"ml-1 bg-primary-foreground text-primary rounded-full w-5 h-5 flex items-center justify-center text-xs",children:ee()})]})})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(R,{className:"text-xs text-muted-foreground",children:[c("Per Page"),":"]}),t.jsxs(H,{value:((I=m.per_page)==null?void 0:I.toString())||"10",onValueChange:e=>{const s={page:1,per_page:parseInt(e)};p&&(s.search=p),Object.entries(x).forEach(([l,r])=>{r&&r!==""&&(s[l]=r)}),f.get(a.endpoint,s,{preserveState:!0,preserveScroll:!0})},children:[t.jsx(W,{className:"w-16 h-8",children:t.jsx(G,{})}),t.jsxs(J,{children:[t.jsx(v,{value:"10",children:"10"}),t.jsx(v,{value:"25",children:"25"}),t.jsx(v,{value:"50",children:"50"}),t.jsx(v,{value:"100",children:"100"})]})]})]})]}),O&&S.length>0&&t.jsx("div",{className:"w-full mt-3 p-4 bg-gray-50 border rounded-md",children:t.jsxs("div",{className:"flex flex-wrap gap-4 items-end",children:[S.map(e=>{var l;const s=e.name||e.key;return t.jsxs("div",{className:"space-y-2",children:[t.jsx(R,{children:e.label}),e.type==="select"&&t.jsxs(H,{value:x[s]||"",onValueChange:r=>te(s,r),children:[t.jsx(W,{className:"w-40",children:t.jsx(G,{placeholder:`All ${e.label}`})}),t.jsx(J,{children:(l=e.options)==null?void 0:l.map(r=>t.jsx(v,{value:r.value,children:r.label},r.value))})]})]},s)}),t.jsx(N,{variant:"outline",size:"sm",className:"h-9",onClick:oe,disabled:!U(),children:c("Reset Filters")})]})})]})}),t.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[t.jsx(xe,{columns:F.columns,actions:F.actions,data:b.data,from:b.from||1,onAction:ie,sortField:m.sort_field,sortDirection:m.sort_direction,onSort:re,statusColors:F.statusColors,permissions:$,entityPermissions:a.permissions}),t.jsxs("div",{className:"p-4 border-t flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm text-muted-foreground",children:[c("Showing")," ",t.jsx("span",{className:"font-medium",children:b.from||0})," ",c("to")," ",t.jsx("span",{className:"font-medium",children:b.to||0})," ",c("of")," ",t.jsx("span",{className:"font-medium",children:b.total})," ",a.name]}),t.jsx("div",{className:"flex gap-1",children:(q=b.links)==null?void 0:q.map((e,s)=>{const l=e.label==="&laquo; Previous"||e.label==="Next &raquo;",r=e.label.replace("&laquo; ","").replace(" &raquo;","");return t.jsx(N,{variant:e.active?"default":"outline",size:l?"sm":"icon",className:l?"px-3":"h-8 w-8",disabled:!e.url,onClick:()=>e.url&&f.get(e.url),children:l?r:t.jsx("span",{dangerouslySetInnerHTML:{__html:e.label}})},`pagination-${s}-${e.label}`)})})]})]}),t.jsx(be,{isOpen:Z,onClose:()=>g(!1),onSubmit:ne,formConfig:{...C,modalSize:w.modalSize||C.modalSize},initialData:u,title:h==="create"?`Add New ${a.name.slice(0,-1).charAt(0).toUpperCase()+a.name.slice(0,-1).slice(1)}`:h==="edit"?`Edit ${a.name.slice(0,-1).charAt(0).toUpperCase()+a.name.slice(0,-1).slice(1)}`:`View ${a.name.slice(0,-1).charAt(0).toUpperCase()+a.name.slice(0,-1).slice(1)}`,mode:h,description:w.description}),t.jsx(Se,{isOpen:k,onClose:()=>_(!1),onConfirm:ce,itemName:(u==null?void 0:u.name)||(u==null?void 0:u.title)||"",entityName:a.name.slice(0,-1),warningMessage:`This ${a.name.slice(0,-1)} and all associated data will be permanently deleted.`})]})}export{_e as P};
