import{r as j,j as e}from"./ui-Ps9nvBG1.js";import{D as O,l as R,n as U,o as X,e as h,I as v,B as x,P as I,X as G,r as J,f as K}from"./app-BTt_gkO3.js";import{T as $}from"./textarea-DPiv_-Qc.js";import{S as A,a as q,b as z,c as B,d as D}from"./select-z0EzYxFC.js";import{C as V}from"./calendar-pZCS8WPy.js";import{T as Q}from"./trash-2-WsAE_ige.js";function ae({isOpen:g,onClose:b,timesheet:d,projects:E=[]}){const[o,p]=j.useState({start_date:"",end_date:"",notes:""}),[c,u]=j.useState([]),[N,T]=j.useState(!1),[C,S]=j.useState([]);j.useEffect(()=>{var a,s,i;if(d&&g)if(d.id&&!d.entries)fetch(route("timesheets.show",d.id)).then(r=>r.json()).then(r=>{var n,m,y;const f=((n=window.appSettings)==null?void 0:n.formatDateForInput(r.timesheet.start_date))||"",t=((m=window.appSettings)==null?void 0:m.formatDateForInput(r.timesheet.end_date))||"";p({start_date:f,end_date:t,notes:r.timesheet.notes||""}),u(((y=r.timesheet.entries)==null?void 0:y.map(l=>{var F,P;return{id:l.id,project_id:((F=l.project_id)==null?void 0:F.toString())||"",task_id:((P=l.task_id)==null?void 0:P.toString())||"none",date:l.date||r.timesheet.start_date,start_time:l.start_time?l.start_time.substring(0,5):"",end_time:l.end_time?l.end_time.substring(0,5):"",hours:l.hours||0,description:l.description||"",is_billable:l.is_billable||!0,hourly_rate:l.hourly_rate||0,created_at:l.created_at,updated_at:l.updated_at}}))||[])});else{const r=((a=window.appSettings)==null?void 0:a.formatDateForInput(d.start_date))||"",f=((s=window.appSettings)==null?void 0:s.formatDateForInput(d.end_date))||"";p({start_date:r,end_date:f,notes:d.notes||""}),u(((i=d.entries)==null?void 0:i.map(t=>{var n,m;return{id:t.id,project_id:((n=t.project_id)==null?void 0:n.toString())||"",task_id:((m=t.task_id)==null?void 0:m.toString())||"none",date:t.date||d.start_date,start_time:t.start_time?t.start_time.substring(0,5):"",end_time:t.end_time?t.end_time.substring(0,5):"",hours:t.hours||0,description:t.description||"",is_billable:t.is_billable||!0,hourly_rate:t.hourly_rate||0,created_at:t.created_at,updated_at:t.updated_at}}))||[])}else g&&(p({start_date:"",end_date:"",notes:""}),u([]))},[d,g]);const k=()=>{const a=new Date;new Date(a.getTime()),new Date(a.getTime()+8*60*60*1e3);const s={project_id:"",task_id:"none",date:o.start_date,start_time:"09:00",end_time:"17:00",hours:0,description:"",is_billable:!0,hourly_rate:0};u([...c,s])},M=a=>{u(c.filter((s,i)=>i!==a))},_=(a,s,i)=>{const r=[...c];r[a]={...r[a],[s]:i},u(r)},H=a=>{const s=E.find(i=>i.id.toString()===a);return(s==null?void 0:s.tasks)||[]},L=a=>{a.preventDefault(),S([]);const s=[];o.start_date||s.push("Please select a start date"),o.end_date||s.push("Please select an end date"),o.start_date&&o.end_date&&o.end_date<o.start_date&&s.push("End date must be after or same as start date"),c.length===0&&s.push("Please add at least one time entry");for(let t=0;t<c.length;t++){const n=c[t];n.project_id||s.push(`Entry ${t+1}: Please select a project`),n.task_id||s.push(`Entry ${t+1}: Please select a task`),n.start_time||s.push(`Entry ${t+1}: Please enter start time`),n.end_time||s.push(`Entry ${t+1}: Please enter end time`)}if(s.length>0){S(s);return}T(!0);const i={...o,entries:c.map(t=>({...t,task_id:t.task_id==="none"?null:t.task_id,start_time:t.start_time?`${o.start_date}T${t.start_time}:00`:"",end_time:t.end_time?`${o.start_date}T${t.end_time}:00`:""}))};console.log("Submitting data:",i);const r=d?route("timesheets.update",d.id):route("timesheets.store");K[d?"put":"post"](r,i,{onSuccess:()=>{b(),p({start_date:"",end_date:"",notes:""}),u([])},onError:t=>{console.log("Backend errors:",t);const n=[];typeof t=="object"&&Object.keys(t).forEach(m=>{Array.isArray(t[m])?n.push(...t[m]):n.push(t[m])}),S(n.length>0?n:["Error submitting timesheet. Please check all fields."])},onFinish:()=>T(!1)})},w=(a,s)=>{p(i=>({...i,[a]:s}))};return e.jsx(O,{open:g,onOpenChange:b,children:e.jsxs(R,{className:"sm:max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(U,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),d?"Edit Timesheet":"New Timesheet"]})}),e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"start_date",children:"Start Date"}),e.jsx(v,{id:"start_date",type:"date",value:o.start_date,onChange:a=>w("start_date",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"end_date",children:"End Date"}),e.jsx(v,{id:"end_date",type:"date",value:o.end_date,onChange:a=>w("end_date",a.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"notes",children:"Notes"}),e.jsx($,{id:"notes",placeholder:"Add any notes about this timesheet...",value:o.notes,onChange:a=>w("notes",a.target.value),rows:2})]}),C.length>0&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("ul",{className:"text-red-700 text-sm space-y-1",children:C.map((a,s)=>e.jsxs("li",{children:["â€¢ ",a]},s))})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(h,{className:"text-base font-semibold",children:"Time Entries"}),e.jsxs(x,{type:"button",onClick:k,size:"sm",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Add Entry"]})]}),c.map((a,s)=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-medium",children:["Entry ",s+1]}),e.jsx(x,{type:"button",variant:"ghost",size:"sm",onClick:()=>M(s),className:"text-red-600 hover:text-red-700",children:e.jsx(Q,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Project *"}),e.jsxs(A,{value:a.project_id,onValueChange:i=>_(s,"project_id",i),required:!0,children:[e.jsx(q,{children:e.jsx(z,{placeholder:"Select project"})}),e.jsx(B,{side:"bottom",align:"start",sideOffset:4,style:{zIndex:999999},children:E.map(i=>e.jsx(D,{value:i.id.toString(),children:i.title},i.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Task *"}),e.jsxs(A,{value:a.task_id||"none",onValueChange:i=>_(s,"task_id",i),required:!0,children:[e.jsx(q,{children:e.jsx(z,{placeholder:"Select task"})}),e.jsxs(B,{side:"bottom",align:"start",sideOffset:4,style:{zIndex:999999},children:[e.jsx(D,{value:"none",children:"No task"}),H(a.project_id).map(i=>e.jsx(D,{value:i.id.toString(),children:i.title},i.id))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Start Time *"}),e.jsx(v,{type:"time",value:a.start_time||"",onChange:i=>_(s,"start_time",i.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"End Time *"}),e.jsx(v,{type:"time",value:a.end_time||"",onChange:i=>_(s,"end_time",i.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Description"}),e.jsx($,{placeholder:"Describe the work done...",value:a.description,onChange:i=>_(s,"description",i.target.value),rows:2})]})]},s)),c.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(V,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No time entries added yet"}),e.jsxs(x,{type:"button",onClick:k,className:"mt-2",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Add First Entry"]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsxs(x,{type:"button",variant:"outline",onClick:b,disabled:N,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs(x,{type:"submit",disabled:N,children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),N?"Saving...":d?"Update":"Create"]})]})]})]})})}export{ae as T};
